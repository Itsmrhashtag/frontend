<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <title>Conversation Page</title>
    <link rel="stylesheet" href="style2.css" />
  </head>
  <body>
    <div style="display: flex; width: 100%; height: 100%">
      <div
        style="
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          padding: 17px;
          width: 5%;
          background-color: rgb(24, 24, 93);
        "
      >
        <div style="display: flex; flex-direction: column; gap: 20px">
          <i id="icon" class="ri-inbox-line"></i>
          <i id="icon" class="ri-award-line"></i>
          <i id="icon" class="ri-cloud-fill"></i>
          <i id="icon" class="ri-pie-chart-line"></i>
          <i id="lastIcon" class="ri-logout-box-line"></i>
        </div>
        <div class="circle">
          <img
            src=""
            alt=""
            id="imageUrl2"
          />
        </div>
      </div>

      <div
        style="width: 20%; border-right: 1px solid rgba(128, 128, 128, 0.539)"
      >
        <div
          style="
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <div
            style="
              display: flex;
              justify-content: center;
              align-items: center;
              gap: 10px;
            "
          >
            <i class="ri-indent-decrease"></i>
            <h1 style="font-size: 3.7vh">Conversations</h1>
          </div>
          <i class="ri-restart-line"></i>
        </div>

        <div style="display: flex; flex-direction: column; gap: 10px">
          <div
            style="
              background-color: rgba(128, 128, 128, 0.441);
              display: flex;
              flex-direction: column;
              gap: 15px;
              padding: 12px;
            "
          >
            <div style="display: flex; justify-content: space-between">
              <div style="display: flex; flex-direction: column; gap: 2px">
                <h3 style="font-weight: 600">Amit RG</h3>
                <h4 style="font-size: 14px">Facebook DM</h4>
              </div>
              <h4 style="font-weight: 400; font-size: 14px">10m</h4>
            </div>
            <div>
              <h4 style="font-size: 13px">Awesome Product</h4>
              <p style="font-size: 13px">
                Hye There! Iprobably did one of the bes...
              </p>
            </div>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              gap: 15px;
              padding: 12px;
            "
          >
            <div style="display: flex; justify-content: space-between">
              <div style="display: flex; flex-direction: column; gap: 2px">
                <h3 style="font-weight: 600">Hiten Saxena</h3>
                <h4 style="font-size: 14px">Facebook Post</h4>
              </div>
              <h4 style="font-weight: 400; font-size: 14px">10m</h4>
            </div>
            <div>
              <h4 style="font-size: 13px">Available in store?</h4>
              <p style="font-size: 13px">
                Hi do you have any T-Shirt available in st...
              </p>
            </div>
          </div>
        </div>
      </div>

      <div
        style="
          width: 55%;
          border-right: 1px solid rgba(128, 128, 128, 0.686);
          min-height: 100%;
        "
      >
        <div
          style="
            padding: 13.2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h1 style="font-size: 20px">Amit RG</h1>
        </div>
        <div
          style="
            padding: 15px;
            background-color: rgba(128, 128, 128, 0.268);
            display: flex;
            flex-direction: column;
            gap: 30px;
            height: 91%;
          "
        >
          <div>
            <div style="display: flex; gap: 15px">
              <div class="circle">
                <img
                  src="https://plus.unsplash.com/premium_photo-1708110769673-c97bb8d17453?q=80&w=2038&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                  alt=""
                  id="imageUrl3"
                />
              </div>
              <p
                style="
                  background-color: white;
                  width: fit-content;
                  padding: 5px;
                  font-size: 14px;
                  font-weight: 600;
                  border-radius: 4px;
                "
              >
                Is it in stock right now
              </p>
            </div>
            <div style="margin-left: 20px">
              <small style="font-size: 11px">Amit RG - Mar 05, 2:22 AM</small>
            </div>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: flex-end;
              gap: 10px;
            "
          >
            <p
              style="
                background-color: white;
                width: fit-content;
                padding: 5px;
                font-size: 14px;
                font-weight: 600;
                border-radius: 4px;
              "
            >
              We've 3 left in stock!
            </p>
            <div>
              <p
                style="
                  background-color: white;
                  width: fit-content;
                  padding: 5px;
                  font-size: 14px;
                  font-weight: 600;
                  border-radius: 4px;
                "
              >
                If you order before 8PM we can ship it today
              </p>
              <div><img src="" alt="" /></div>
            </div>
            <small style="font-size: 11px">Amit RG - Mar 05, 2:22 AM</small>
          </div>
          <div style="position: absolute; bottom: 5%; width: 50%">
            <input type="text" placeholder="Message " id="messageInput"/>
          </div>
        </div>
      </div>

      <div style="width: 20%; background-color: rgba(128, 128, 128, 0.25)">
        <div
          style="
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: white;
          "
        >
          <div style="margin-bottom: 10px" class="circle" id="cir">
            <img
              src=""
              alt=""
              id="imageUrl"
            />
          </div>
          <h1 style="font-size: 17px" id="userName"></h1>
          <p style="font-size: 14px">Offline</p>
          <div style="margin-top: 15px">
            <button style="margin-right: 20px; padding: 2px; font-weight: 600">
              <i class="ri-phone-line"></i> Call</button
            ><button style="padding: 2px; font-weight: 600">
              <i class="ri-user-3-line"></i> Profile
            </button>
          </div>
        </div>
        <div>
          <div
            style="
              width: 92%;
              background-color: white;
              margin: 10px;
              padding: 10px;
              border-radius: 5px;
            "
          >
            <h1 style="font-size: 17px">Customer details</h1>
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-top: 15px;
              "
            >
              <p style="font-size: 14px">Email</p>
              <small style="font-weight: 600" id="email"></small>
            </div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-top: 5px;
              "
            >
              <p style="font-size: 14px">First Name</p>
              <small style="font-weight: 600" id="firstName"></small>
            </div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-top: 5px;
                margin-bottom: 15px;
              "
            >
              <p style="font-size: 14px">Last Name</p>
              <small style="font-weight: 600"id="lastName"></small>
            </div>
            <a
              href=""
              style="
                font-size: 15px;
                font-weight: 600;
                color: deepskyblue;
                text-decoration: none;
              "
              >View more details</a
            >
          </div>
        </div>
      </div>
    </div>
    <script>

      document.getElementById('lastIcon').addEventListener('click', function() {
        alert("Logout Successfully!!");
        window.location.href = 'login.html';
      });
        function getTokenFromLocalStorage() {
            return localStorage.getItem('accessToken');
        }

        function getUserDetails() {
            const token = getTokenFromLocalStorage();

            if (!token) {
                console.error('Access token not found in local storage');
                return;
            }

            const headers = new Headers();

            headers.append('Authorization', 'Bearer ' + token);

            fetch('http://localhost:8081/user/me', {
                headers: headers 
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('User Details:', data);
                const fullName = data.name.split(' ');
                const firstName = fullName[0];
                const lastName = fullName.slice(1).join(' ');
                document.getElementById('userName').innerText = data.name;
                document.getElementById('email').innerText = data.email;
                document.getElementById('imageUrl').src = data.imageUrl;
                document.getElementById('imageUrl2').src = data.imageUrl;
                document.getElementById('imageUrl3').src = data.imageUrl;
                document.getElementById('firstName').innerText = firstName;
                document.getElementById('lastName').innerText = lastName;
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                messageInput.placeholder = "Message " + data.name;
            }
                
            })
            .catch(error => console.error('Error fetching user details:', error));
        }
        window.onload = function() {
        if (getTokenFromLocalStorage()) {
            getUserDetails();
        } else {
            alert('Waiting for user authentication...');
            window.location.href = 'login.html';
        }
        };
    </script>
  </body>
</html>